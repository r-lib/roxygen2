<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Extending roxygen2 • roxygen2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Extending roxygen2">
<meta property="og:description" content="roxygen2">
<meta property="og:image" content="https://roxygen2.r-lib.org/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">roxygen2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">7.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/roxygen2.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/extending.html">Extending roxygen2</a>
    </li>
    <li>
      <a href="../articles/namespace.html">NAMESPACE tags</a>
    </li>
    <li>
      <a href="../articles/rd-formatting.html">Rd formatting</a>
    </li>
    <li>
      <a href="../articles/rd.html">Rd (documentation) tags</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Release notes</li>
    <li>
      <a href="https://www.tidyverse.org/blog/2020/03/roxygen2-7-1-0/">Version 7.1.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/blog/2019/11/roxygen2-7-0-0/">Version 7.0.0</a>
    </li>
    <li>
      <a href="https://blog.rstudio.com/2017/02/01/roxygen2-6-0-0/">Version 6.0.0</a>
    </li>
    <li>
      <a href="https://blog.rstudio.com/2015/10/29/roxygen2-5-0-0/">Version 5.0.0</a>
    </li>
    <li>
      <a href="https://blog.rstudio.com/2014/05/19/roxygen2-4-0-1/">Version 4.0.1</a>
    </li>
    <li>
      <a href="https://blog.rstudio.com/2013/12/09/roxygen2-3-0-0/">Version 3.0.0</a>
    </li>
    <li class="divider">
    <li>
      <a href="../news/index.html">Change log</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/r-lib/roxygen2/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Extending roxygen2</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-lib/roxygen2/blob/master/vignettes/extending.Rmd"><code>vignettes/extending.Rmd</code></a></small>
      <div class="hidden name"><code>extending.Rmd</code></div>

    </div>

    
    
<div id="basics" class="section level2">
<h2 class="hasAnchor">
<a href="#basics" class="anchor"></a>Basics</h2>
<p>Roxygen is extensible with user-defined <strong>roclets</strong>. It means that you can take advantage of Roxygen’s parser and extend it with your own <code>@tags</code>.</p>
<p>There are two primary ways to extend roxygen2:</p>
<ul>
<li><p>Add new tag that generates a new top-level section in <code>.Rd</code> files.</p></li>
<li><p>Add a new roclet that does anything you like.</p></li>
</ul>
<p>This vignette will introduce you to the key data structures in roxygen2, and then show you how to use these two extension points. This vignette is very rough, so you should expect to have to also read some roxygen2 source code to understand all the extension points. Hopefully it’s useful enough to help you get started, and if you have problems, please <a href="https://github.com/r-lib/roxygen2/issues/new">file an issue</a>!</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">roxygen2</span>)</pre></body></html></div>
</div>
<div id="key-data-structures" class="section level2">
<h2 class="hasAnchor">
<a href="#key-data-structures" class="anchor"></a>Key data structures</h2>
<p>Before we talk about extending roxygen2, we need to first discuss two important data structures that power roxygen: tags and blocks.</p>
<div id="tags" class="section level3">
<h3 class="hasAnchor">
<a href="#tags" class="anchor"></a>Tags</h3>
<p>A tag (a list with S3 class <code>roxy_tag</code>) represents a single tag. It has the following fields:</p>
<ul>
<li><p><code>tag</code>: the name of the tag.</p></li>
<li><p><code>raw</code>: the raw contents of the tag (i.e. everything from the end of this tag to the beginning of the next).</p></li>
<li><p><code>val</code>: the parsed value, which we’ll come back to shortly.</p></li>
<li><p><code>file</code> and <code>line</code>: the location of the tag in the package. Used with <code><a href="../reference/roxy_tag.html">roxy_tag_warning()</a></code> to produce informative error messages.</p></li>
</ul>
<p>You <em>can</em> construct tag objects by hand with <code><a href="../reference/roxy_tag.html">roxy_tag()</a></code>:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="../reference/roxy_tag.html">roxy_tag</a></span>(<span class="st">"name"</span>, <span class="st">"Hadley"</span>)
<span class="co">#&gt; [????:???] @name 'Hadley' {unparsed}</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="fu"><a href="../reference/roxy_tag.html">roxy_tag</a></span>(<span class="st">"name"</span>, <span class="st">"Hadley"</span>))
<span class="co">#&gt; List of 5</span>
<span class="co">#&gt;  $ file: chr NA</span>
<span class="co">#&gt;  $ line: int NA</span>
<span class="co">#&gt;  $ raw : chr "Hadley"</span>
<span class="co">#&gt;  $ tag : chr "name"</span>
<span class="co">#&gt;  $ val : NULL</span>
<span class="co">#&gt;  - attr(*, "class")= chr [1:2] "roxy_tag_name" "roxy_tag"</span></pre></body></html></div>
<p>However, you should rarely need to do so, because you’ll typically have them given to you in a block object, as you’ll see shortly.</p>
</div>
<div id="blocks" class="section level3">
<h3 class="hasAnchor">
<a href="#blocks" class="anchor"></a>Blocks</h3>
<p>A block (a list with S3 class <code>roxy_block</code>) represents a single roxygen block. It has the following fields:</p>
<ul>
<li>
<code>tags</code>: a list of <code>roxy_tags</code>.</li>
<li>
<code>call</code>: the R code associated with the block (usually a function call).</li>
<li>
<code>file</code> and <code>line</code>: the location of the R code.</li>
<li>
<code>object</code>: the evaluated R object associated with the code.</li>
</ul>
<p>The easiest way to see the basic structure of a <code><a href="../reference/roxy_block.html">roxy_block()</a></code> is to generate one by parsing a roxygen block with <code><a href="../reference/parse_package.html">parse_text()</a></code>:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">text</span> <span class="kw">&lt;-</span> <span class="st">"
  #' This is a title
  #'
  #' This is the description.
  #'
  #' @param x,y A number
  #' @export
  f &lt;- function(x, y) x + y
"</span>

<span class="co"># parse_text() returns a list of blocks, so I extract the first</span>
<span class="no">block</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/parse_package.html">parse_text</a></span>(<span class="no">text</span>)<span class="kw">[[</span><span class="fl">1</span>]]
<span class="no">block</span>
<span class="co">#&gt; &lt;roxy_block&gt; [&lt;text&gt;:8]</span>
<span class="co">#&gt;   $tag</span>
<span class="co">#&gt;     [line:  1] @title 'This is a title' {parsed}</span>
<span class="co">#&gt;     [line:  3] @description 'This is the description.' {parsed}</span>
<span class="co">#&gt;     [line:  6] @param 'x,y A number' {parsed}</span>
<span class="co">#&gt;     [line:  7] @export '' {parsed}</span>
<span class="co">#&gt;     [????:???] @usage '&lt;generated&gt;' {parsed}</span>
<span class="co">#&gt;     [????:???] @.formals '&lt;generated&gt;' {parsed}</span>
<span class="co">#&gt;     [????:???] @backref '&lt;text&gt;' {parsed}</span>
<span class="co">#&gt;   $call   f &lt;- function(x, y) x + y</span>
<span class="co">#&gt;   $object &lt;function&gt; </span>
<span class="co">#&gt;     $topic f</span>
<span class="co">#&gt;     $alias f</span></pre></body></html></div>
</div>
</div>
<div id="adding-a-new--rd-tag" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-a-new--rd-tag" class="anchor"></a>Adding a new <code>.Rd</code> tag</h2>
<p>The easiest way to extend roxygen2 is to create a new tag that adds output to <code>.Rd</code> files. This requires two steps:</p>
<ol style="list-style-type: decimal">
<li><p>Define a <code><a href="../reference/roxy_tag.html">roxy_tag_parse()</a></code> method that describes how to parse our new tag.</p></li>
<li><p>Define a <code><a href="../reference/roxy_tag_rd.html">roxy_tag_rd()</a></code> method that describes how to convert the tag into <code>.Rd</code> commands.</p></li>
</ol>
<p>To illustrate the basic idea we’ll create a new <code>@tip</code> tag that will create a bulleted list of tips about how to use a function. The idea is to take something like this:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co">#' @tip The mean of a logical vector is the proportion of `TRUE` values.</span>
<span class="co">#' @tip You can compute means of dates and date-times!</span></pre></body></html></div>
<p>And generate Rd like this:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode latex"><code class="sourceCode latex"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">\section</span>{Tips and tricks}{</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">\itemize</span>{</span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="fu">\item</span> The mean of a logical vector is the proportion of <span class="fu">\code</span>{TRUE} values.</span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="fu">\item</span> You can compute means of dates and date-times!</span>
<span id="cb5-5"><a href="#cb5-5"></a>}</span>
<span id="cb5-6"><a href="#cb5-6"></a>}</span></code></pre></div>
<p>The first step is to define a method for <code><a href="../reference/roxy_tag.html">roxy_tag_parse()</a></code> that describes how to turn the parse the tag text. The name of the class will be <code>roxy_tag_{tag}</code>, which in this case is <code>roxy_tag_tip</code>. This function takes a <code>roxy_tag</code> as input, and it’s job is to set <code>x$val</code> to a convenient parsed value that will be used later by the roclet. Here we want to process the text using markdown so we can just use <code><a href="../reference/tag_parsers.html">tag_markdown()</a></code>:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">roxy_tag_parse.roxy_tag_tip</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) {
  <span class="fu"><a href="../reference/tag_parsers.html">tag_markdown</a></span>(<span class="no">x</span>)
}</pre></body></html></div>
<p>We check this works by using <code><a href="../reference/parse_package.html">parse_text()</a></code>:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">text</span> <span class="kw">&lt;-</span> <span class="st">"
  #' Title
  #'
  #' @tip The mean of a logical vector is the proportion of `TRUE` values.
  #' @tip You can compute means of dates and date-times!
  #' @md
  f &lt;- function(x, y) {
    # ...
  }
"</span>
<span class="no">block</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/parse_package.html">parse_text</a></span>(<span class="no">text</span>)<span class="kw">[[</span><span class="fl">1</span>]]
<span class="no">block</span>
<span class="co">#&gt; &lt;roxy_block&gt; [&lt;text&gt;:7]</span>
<span class="co">#&gt;   $tag</span>
<span class="co">#&gt;     [line:  1] @title 'Title' {parsed}</span>
<span class="co">#&gt;     [line:  4] @tip 'The mean of a logical vector is the proportion ...' {parsed}</span>
<span class="co">#&gt;     [line:  5] @tip 'You can compute means of dates and date-times!' {parsed}</span>
<span class="co">#&gt;     [line:  6] @md '' {parsed}</span>
<span class="co">#&gt;     [????:???] @usage '&lt;generated&gt;' {parsed}</span>
<span class="co">#&gt;     [????:???] @.formals '&lt;generated&gt;' {parsed}</span>
<span class="co">#&gt;     [????:???] @backref '&lt;text&gt;' {parsed}</span>
<span class="co">#&gt;   $call   f &lt;- function(x, y) { ...</span>
<span class="co">#&gt;   $object &lt;function&gt; </span>
<span class="co">#&gt;     $topic f</span>
<span class="co">#&gt;     $alias f</span>

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">block</span>$<span class="no">tags</span><span class="kw">[[</span><span class="fl">2</span>]])
<span class="co">#&gt; List of 5</span>
<span class="co">#&gt;  $ file: chr "&lt;text&gt;"</span>
<span class="co">#&gt;  $ line: int 4</span>
<span class="co">#&gt;  $ tag : chr "tip"</span>
<span class="co">#&gt;  $ raw : chr "The mean of a logical vector is the proportion of `TRUE` values."</span>
<span class="co">#&gt;  $ val : chr "The mean of a logical vector is the proportion of \\code{TRUE} values."</span>
<span class="co">#&gt;  - attr(*, "class")= chr [1:2] "roxy_tag_tip" "roxy_tag"</span></pre></body></html></div>
<p>(Here I explicit turn markdown parsing on using <code>@md</code>; it’s usually turned on for a package using roxygen options).</p>
<p>Next we define a method for <code><a href="../reference/roxy_tag_rd.html">roxy_tag_rd()</a></code>, which must create an <code><a href="../reference/rd_section.html">rd_section()</a></code>. We’re going to create a new section called <code>tip</code>. It will contain a character vector of tips:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">roxy_tag_rd.roxy_tag_tip</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">base_path</span>, <span class="no">env</span>) {
  <span class="fu"><a href="../reference/rd_section.html">rd_section</a></span>(<span class="st">"tip"</span>, <span class="no">x</span>$<span class="no">val</span>)
}</pre></body></html></div>
<p>This additional layer is needed because there can multiple tags of the same time in a single block, and multiple blocks can contribute to the same <code>.Rd</code> file. The job of the <code>rd_section</code> is to combine all the tags into a single top-level Rd section. Each tag generates an <code>rd_section</code> which is then combined with any previous section using <code><a href="https://rdrr.io/r/base/merge.html">merge()</a></code>. The default <code>merge.rd_section()</code> just concatenates the values together (<code><a href="../reference/rd_section.html">rd_section(x$type, c(x$value, y$value))</a></code>); you can override this method if you need more sophisticated behaviour.</p>
<p>We then need to define a <code><a href="https://rdrr.io/r/base/format.html">format()</a></code> method to converts this object into text for the <code>.Rd</code> file:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">format.rd_section_tip</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">...</span>) {
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(
    <span class="st">"\\section{Tips and tricks}{\n"</span>,
    <span class="st">"\\itemize{\n"</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"  \\item "</span>, <span class="no">x</span>$<span class="no">value</span>, <span class="st">"\n"</span>, <span class="kw">collapse</span> <span class="kw">=</span> <span class="st">""</span>),
    <span class="st">"}\n"</span>,
    <span class="st">"}\n"</span>
  )
}</pre></body></html></div>
<p>We can now try this out with <code>roclet_text()</code>:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">topic</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/roc_proc_text.html">roc_proc_text</a></span>(<span class="fu"><a href="../reference/rd_roclet.html">rd_roclet</a></span>(), <span class="no">text</span>)<span class="kw">[[</span><span class="fl">1</span>]]
<span class="no">topic</span>$<span class="fu">get_section</span>(<span class="st">"tip"</span>)
<span class="co">#&gt; \section{Tips and tricks}{</span>
<span class="co">#&gt; \itemize{</span>
<span class="co">#&gt;   \item The mean of a logical vector is the proportion of \code{TRUE} values.</span>
<span class="co">#&gt;   \item You can compute means of dates and date-times!</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; </span></pre></body></html></div>
<p>Note that there is no namespacing so if you’re defining multiple new tags I recommend using your package name as common prefix.</p>
</div>
<div id="creating-a-new-roclet" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-a-new-roclet" class="anchor"></a>Creating a new roclet</h2>
<p>Creating a new roclet is usually a two part process. First, you define new tags that your roclet will work with. Second, you define a roclet that tells roxygen how to process an entire package.</p>
<div id="custom-tags" class="section level3">
<h3 class="hasAnchor">
<a href="#custom-tags" class="anchor"></a>Custom tags</h3>
<p>In this example we will make a new <code>@memo</code> tag to enable printing the memos at the console when the roclet runs. We choose that the <code>@memo</code> has this syntax:</p>
<pre><code>@memo [Headline] Description</code></pre>
<p>As an example:</p>
<pre><code>@memo [EFFICIENCY] Currently brute-force; find better algorithm.</code></pre>
<p>As above, we first define a parse method:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">roxy_tag_parse.roxy_tag_memo</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) {
  <span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"^\\[.*\\].*$"</span>, <span class="no">x</span>$<span class="no">raw</span>)) {
    <span class="fu"><a href="../reference/roxy_tag.html">roxy_tag_warning</a></span>(<span class="no">x</span>, <span class="st">"Invalid memo format"</span>)
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>()
  }

  <span class="no">parsed</span> <span class="kw">&lt;-</span> <span class="kw pkg">stringi</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_match.html">stri_match</a></span>(<span class="kw">str</span> <span class="kw">=</span> <span class="no">x</span>$<span class="no">raw</span>, <span class="kw">regex</span> <span class="kw">=</span> <span class="st">"\\[(.*)\\](.*)"</span>)[<span class="fl">1</span>, ]

  <span class="no">x</span>$<span class="no">val</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    <span class="kw">header</span> <span class="kw">=</span> <span class="no">parsed</span><span class="kw">[[</span><span class="fl">2</span>]],
    <span class="kw">message</span> <span class="kw">=</span> <span class="no">parsed</span><span class="kw">[[</span><span class="fl">3</span>]]
  )
  <span class="no">x</span>
}</pre></body></html></div>
<p>Then check it works with <code><a href="../reference/parse_package.html">parse_text()</a></code>:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">text</span> <span class="kw">&lt;-</span> <span class="st">"
  #' @memo [TBI] Remember to implement this!
  #' @memo [API] Check best API
  f &lt;- function(x, y) {
    # ...
  }
"</span>
<span class="no">block</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/parse_package.html">parse_text</a></span>(<span class="no">text</span>)<span class="kw">[[</span><span class="fl">1</span>]]
<span class="no">block</span>
<span class="co">#&gt; &lt;roxy_block&gt; [&lt;text&gt;:4]</span>
<span class="co">#&gt;   $tag</span>
<span class="co">#&gt;     [line:  2] @memo '[TBI] Remember to implement this!' {parsed}</span>
<span class="co">#&gt;     [line:  3] @memo '[API] Check best API' {parsed}</span>
<span class="co">#&gt;     [????:???] @usage '&lt;generated&gt;' {parsed}</span>
<span class="co">#&gt;     [????:???] @.formals '&lt;generated&gt;' {parsed}</span>
<span class="co">#&gt;     [????:???] @backref '&lt;text&gt;' {parsed}</span>
<span class="co">#&gt;   $call   f &lt;- function(x, y) { ...</span>
<span class="co">#&gt;   $object &lt;function&gt; </span>
<span class="co">#&gt;     $topic f</span>
<span class="co">#&gt;     $alias f</span>

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">block</span>$<span class="no">tags</span><span class="kw">[[</span><span class="fl">1</span>]])
<span class="co">#&gt; List of 5</span>
<span class="co">#&gt;  $ file: chr "&lt;text&gt;"</span>
<span class="co">#&gt;  $ line: int 2</span>
<span class="co">#&gt;  $ tag : chr "memo"</span>
<span class="co">#&gt;  $ raw : chr "[TBI] Remember to implement this!"</span>
<span class="co">#&gt;  $ val :List of 2</span>
<span class="co">#&gt;   ..$ header : chr "TBI"</span>
<span class="co">#&gt;   ..$ message: chr " Remember to implement this!"</span>
<span class="co">#&gt;  - attr(*, "class")= chr [1:2] "roxy_tag_memo" "roxy_tag"</span></pre></body></html></div>
</div>
<div id="the-roclet" class="section level3">
<h3 class="hasAnchor">
<a href="#the-roclet" class="anchor"></a>The roclet</h3>
<p>Next we create a constructor for the roclet, which uses <code><a href="../reference/roclet.html">roclet()</a></code>. Our <code>memo</code> roclet doesn’t have any options so this is very simple:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">memo_roclet</span> <span class="kw">&lt;-</span> <span class="kw">function</span>() {
  <span class="fu"><a href="../reference/roclet.html">roclet</a></span>(<span class="st">"memo"</span>)
}</pre></body></html></div>
<p>To give the roclet behaviour, you need to define method. There are two methods that almost every roclet will use:</p>
<ul>
<li><p><code><a href="../reference/roclet.html">roclet_process()</a></code> is called with a list of blocks, and returns an object of your choosing.</p></li>
<li><p><code><a href="../reference/roclet.html">roclet_output()</a></code>: performs side-effects (usually writing to disk) using the result from <code><a href="../reference/roclet.html">roclet_process()</a></code></p></li>
</ul>
<p>For this roclet, we’ll have <code><a href="../reference/roclet.html">roclet_process()</a></code> collect all the memo tags into a named list:</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">roclet_process.roclet_memo</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">blocks</span>, <span class="no">env</span>, <span class="no">base_path</span>) {
  <span class="no">results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()

  <span class="kw">for</span> (<span class="no">block</span> <span class="kw">in</span> <span class="no">blocks</span>) {
    <span class="no">tags</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/roxy_block.html">block_get_tags</a></span>(<span class="no">block</span>, <span class="st">"memo"</span>)

    <span class="kw">for</span> (<span class="no">tag</span> <span class="kw">in</span> <span class="no">tags</span>) {
      <span class="no">msg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"["</span>, <span class="no">tag</span>$<span class="no">file</span>, <span class="st">":"</span>, <span class="no">tag</span>$<span class="no">line</span>, <span class="st">"] "</span>, <span class="no">tag</span>$<span class="no">val</span>$<span class="no">message</span>)
      <span class="no">results</span><span class="kw">[[</span><span class="no">tag</span>$<span class="no">val</span>$<span class="no">header</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">results</span><span class="kw">[[</span><span class="no">tag</span>$<span class="no">val</span>$<span class="no">header</span>]], <span class="no">msg</span>)
    }
  }

  <span class="no">results</span>
}</pre></body></html></div>
<p>And then have <code><a href="../reference/roclet.html">roclet_output()</a></code> just print them to the screen:</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">roclet_output.roclet_memo</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">results</span>, <span class="no">base_path</span>, <span class="no">...</span>) {
  <span class="kw">for</span> (<span class="no">header</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">results</span>)) {
    <span class="no">messages</span> <span class="kw">&lt;-</span> <span class="no">results</span><span class="kw">[[</span><span class="no">header</span>]]
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">header</span>, <span class="st">": "</span>, <span class="st">"\n"</span>))
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">" * "</span>, <span class="no">messages</span>, <span class="st">"\n"</span>, <span class="kw">collapse</span> <span class="kw">=</span> <span class="st">""</span>))
  }

  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span>(<span class="kw">NULL</span>)
}</pre></body></html></div>
<p>Then you can test it works by using <code><a href="../reference/roc_proc_text.html">roc_proc_text()</a></code>:</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/roc_proc_text.html">roc_proc_text</a></span>(<span class="fu">memo_roclet</span>(), <span class="st">"
#' @memo [TBI] Remember to implement this!
#' @memo [API] Check best API
f &lt;- function(x, y) {
  # ...
}

#' @memo [API] Consider passing z option
g &lt;- function(x, y) {
  # ...
}
"</span>)
<span class="fu"><a href="../reference/roclet.html">roclet_output</a></span>(<span class="fu">memo_roclet</span>(), <span class="no">results</span>)
<span class="co">#&gt; TBI: </span>
<span class="co">#&gt;  * [&lt;text&gt;:2]  Remember to implement this!</span>
<span class="co">#&gt; API: </span>
<span class="co">#&gt;  * [&lt;text&gt;:3]  Check best API</span>
<span class="co">#&gt;  * [&lt;text&gt;:8]  Consider passing z option</span></pre></body></html></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://hadley.nz">Hadley Wickham</a>, Peter Danenberg, Gábor Csárdi, Manuel Eugster.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
