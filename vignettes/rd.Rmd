---
title: "Documentation topics"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Documentation topics}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(comment = "#>", collapse = TRUE)
```

## Basics

A roxygen **block** is a sequence of lines starting with `#'` (optionally preceded by whitespace).
The first lines of the block is called the **introduction** and forms the title, description, and details, as described next.
The introduction continues until the first **tag**.
Tags start with `@`, like `@details` or `@param`.
Tags must appear at the beginning of a line and their content extends to the start of the next tag or the end of the block.
Text within the description or tags can be formatted using Markdown or `Rd` commands; see `vignette("rd-formatting")` for details.

A block continues until it hits R code, typically a function or object assignment.
Blocks ignore empty lines, including lines made up of non-roxygen comments.
If you need to separate two blocks, use `NULL`.

## The introduction

Each documentation block starts with some text which defines the title, the description, and the details.
Here's an example showing what the documentation for `sum()` might look like if it had been written with roxygen:

```{r}
#' Sum of vector elements
#'
#' `sum` returns the sum of all the values present in its arguments.
#'
#' This is a generic function: methods can be defined for it directly
#' or via the [Summary()] group generic. For this to work properly,
#' the arguments `...` should be unnamed, and dispatch is on the
#' first argument.
sum <- function(..., na.rm = TRUE) {}
```

This introductory block is broken up as follows:

-   The first sentence is the **title**: that's what you see when you look at `help(package = mypackage)` and is shown at the top of each help file.
    It should generally fit on one line, be written in sentence case, and not end in a full stop.

-   The second paragraph is the **description**: this comes first in the documentation and should briefly describe what the function does.

-   The third and subsequent paragraphs go into the **details**: this is a (often long) section that comes after the argument description and should provide any other important details of how the function operates.
    The details are optional.

You can also use explicit `@title`, `@description`, and `@details` tags.
This is unnecessary unless you want to have a multi-paragraph description, bulleted list, or other more exotic structure.

```{r}
#' Sum of vector elements
#' 
#' @description
#' `sum` returns the sum of all the values present in its arguments.
#'
#' @details
#' This is a generic function: methods can be defined for it directly
#' or via the [Summary()] group generic. For this to work properly,
#' the arguments `...` should be unnamed, and dispatch is on the
#' first argument.
```

## Functions

Functions are the mostly commonly documented objects.
Functions require three tags: `@param`, `@returns`, and `@examples`.

### Inputs

Use `@param name description` to describe each input to the function.
The description should provide a succinct summary of parameter type (e.g. a string, a numeric vector), and if not obvious from the name, what the parameter does.
The description is a sentence so should start with a capital letter and end with a full stop.
It can span multiple lines (or even paragraphs) if necessary.
All parameters must be documented.

If two or more arguments are tightly coupled, you can document them in one place by separating the names with commas (no spaces).
For example, to document both `x` and `y`, you can say `@param x,y Numeric vectors`.

### Outputs

`@returns description` describes the output from the function.
Briefly describe the type/shape of the output, not the details.

All functions must have a documented return value for initial CRAN submission.

### Examples

`@examples` provides executable R code showing how to use the function in practice.
This is a very important part of the documentation because many people look at the examples before reading anything.
Example code must work without errors as it is run automatically as part of `R CMD check`.

For the purpose of illustration, it's often useful to include code that causes an error.
You can do this by wrapping the code in `try()` or using `\dontrun{}` to exclude from the executed example code.

For finer control, you can use `@examplesIf`:

``` r
#' @examplesIf interactive()
#' browseURL("https://roxygen2.r-lib.org")
```

This generates

    \examples{
    \dontshow{if (interactive() (if (getRversion() >= "3.4") withAutoprint else force)(\{ # examplesIf}
    gh_organizations(since = 42)
    \dontshow{\}) # examplesIf}
    }

This way, the code evaluating whether the example can be run is not shown to users reading the help, but it still prevents R CMD check failures.

Instead of including examples directly in the documentation, you can put them in separate files and use `@example path/relative/to/package/root` to insert them into the documentation.

All functions must have a documented return value for initial CRAN submission.

### Usage

In most case, the function usage (which appears beneath the description in the generates docs) will be automatically derived from the function specification.
For the cases where it is not, please [file an issue](https://github.com/r-lib/roxygen2/issues) and use `@usage` to override the default with you want.
If you want to suppress the usage altogether (which is sometimes useful for internal or deprecated functions), you can use `@usage NULL`.

## Datasets

Datasets are stored in `data/`, not as regular R objects in the package.
This means you need to document them in a slightly different way: instead of documenting the data directly, you quote the dataset's name.

```{r}
#' Prices of over 50,000 round cut diamonds
#'
#' A dataset containing the prices and other attributes of almost 54,000
#'  diamonds. The variables are as follows:
#'
#' @format A data frame with 53940 rows and 10 variables:
#' \describe{
#'   \item{price}{price in US dollars ($326--$18,823)}
#'   \item{carat}{weight of the diamond (0.2--5.01)}
#'   \item{cut}{quality of the cut (Fair, Good, Very Good, Premium, Ideal)}
#'   \item{color}{diamond colour, from D (best) to J (worst)}
#'   \item{clarity}{a measurement of how clear the diamond is (I1 (worst), SI2,
#'     SI1, VS2, VS1, VVS2, VVS1, IF (best))}
#'   \item{x}{length in mm (0--10.74)}
#'   \item{y}{width in mm (0--58.9)}
#'   \item{z}{depth in mm (0--31.8)}
#'   \item{depth}{total depth percentage = z / mean(x, y) = 2 * z / (x + y) (43--79)}
#'   \item{table}{width of top of diamond relative to widest point (43--95)}
#' }
```

Note the use of two additional tags that are particularly useful for documenting data:

-   `@format`, which gives an overview of the structure of the dataset.
    This should include a **definition list** that describes each variable.
    There's currently no way to generate this with Markdown, so this is one of the few places you'll need to Rd markup directly.

-   `@source` where you got the data form, often a URL.

## Packages

As well as documenting every object inside the package, you can also document the package itself by documenting the special sentinel `"_PACKAGE"`.
This automatically include information parsed from the `DESCRIPTION`, including title, description, list of authors, and useful URLs.

We recommend placing package documentation in `{pkgname}-package.R`, and have `@keywords internal`.
Use `usethis::use_package_doc()` to set up automatically.

Here's an example:

```{r, eval = FALSE}
#' @keywords internal 
"_PACKAGE"
```

Package documentation is a good place to put `# Package options` that documents options used by the package.

Some notes:

-   By default, aliases will be added so that both `?pkgname` and `package?pkgname` will find the package help.
    If there's an existing function called `pkgname`, use `@aliases {pkgname}-package` to override the default.

-   Use `@references` to point to published material about the package that users might find helpful.

## Object-oriented programming

The following sections describe the most commonly used tags for the various OOPS systems supported by roxygen2: S3, S4, and R6

### S3

-   S3 **generics** are regular functions, so document them as such.
    If necessary, include a `@section` that provides additional details for developers implementing methods.

-   S3 **classes** have no formal definition, so document the [constructor](https://adv-r.hadley.nz/s3.html#s3-constructor).

-   It is your choice whether or not to document S3 **methods**.
    Generally, it's not necessary to document straightforward methods for common generics like `print()`.
    (You should, however, always `@export` S3 methods).

    If your method is more complicated, you should document it by setting `@rdname`.
    Typically you will document methods with their generic, so you'd document `foofy.data.frame` by setting `@rdname`.
    In base R, you can find documentation for more complex methods like `?predict.lm`, `?predict.glm`, and `?anova.glm`.

-   Generally, roxygen2 will automatically figure out the generic that the method belongs to, and you should only need to use `@method` if there is ambiguity.
    For example, is `all.equal.data.frame()` the `equal.data.frame` method for `all()`, or the `data.frame` method for `all.equal()`?.
    If this happens to you, disambiguate with (e.g.) `@method all.equal data.frame`.

### S4

S4 **generics** are also functions, so document them as such.

Document **S4 classes** by adding a roxygen block before `setClass()`.
Use `@slot` to document the slots of the class.
Here's a simple example:

```{r}
#' An S4 class to represent a bank account
#'
#' @slot balance A length-one numeric vector
Account <- setClass("Account",
  slots = list(balance = "numeric")
)
```

S4 **methods** are a little more complicated.
Unlike S3 methods, all S4 methods must be documented.
You can document them in three places:

-   In the class.
    Most appropriate if the corresponding generic uses single dispatch and you created the class.

-   In the generic.
    Most appropriate if the generic uses multiple dispatches and you control it.

-   In its own file.
    Most appropriate if the method is complex.
    or the either two options don't apply.

Use either `@rdname` or `@describeIn` to control where method documentation goes.
See the next section for more details.

### R6

-   R6 methods can be documented in-line, i.e. the method's documentation comments come right before the definition of the method.

-   Method documentation can use the `@description`, `@details`, `@param`, `@return` and `@examples` tags.
    These are used to create a subsection for the method, within a separate 'Methods' section.
    All roxygen comment lines of a method documentation must appear after a tag.

-   `@param` tags that appear before the class definition are automatically inherited by all methods, if needed.

-   R6 fields and active bindings can make use of the `@field` tag.
    Their documentation should also be in-line.

-   roxygen2 checks that all public methods, public fields, active bindings and all method arguments are documented, and issues warnings otherwise.

-   To turn off the special handling of R6 classes and go back to the roxygen2 6.x.x behavior, use the `r6 = FALSE` option in `DESCRIPTION`, in the `Roxygen` entry: `Roxygen: list(r6 = FALSE)`.

roxygen2 automatically generates additional sections for an R6 class:

-   A section with information about the superclass(es) of the class, with links.
    In HTML this includes a list of all inherited methods, with links.

-   An 'Examples' section that contains all class and method examples.
    This section is run by `R CMD check`, so method examples must work without errors.

An example from the R6 tutorial:

```{r}
#' R6 Class Representing a Person
#'
#' @description
#' A person has a name and a hair color.
#'
#' @details
#' A person can also greet you.

Person <- R6::R6Class("Person",
public = list(

    #' @field name First or full name of the person.
    name = NULL,

    #' @field hair Hair color of the person.
    hair = NULL,

    #' @description
    #' Create a new person object.
    #' @param name Name.
    #' @param hair Hair color.
    #' @return A new `Person` object.
    initialize = function(name = NA, hair = NA) {
      self$name <- name
      self$hair <- hair
      self$greet()
    },

    #' @description
    #' Change hair color.
    #' @param val New hair color.
    #' @examples
    #' P <- Person("Ann", "black")
    #' P$hair
    #' P$set_hair("red")
    #' P$hair
    set_hair = function(val) {
      self$hair <- val
    },

    #' @description
    #' Say hi.
    greet = function() {
      cat(paste0("Hello, my name is ", self$name, ".\n"))
    }
  )
)
```

## Other tags

### Cross-references

There are two tags that make it easier for people to navigate your documentation: `@seealso` and `@family`.
`@seealso` allows you to point to other useful resources, either on the web `<http://www.r-project.org>` or to other documentation with `[function_name()]`.
If you have a family of related functions, you can use `@family {family}` to cross-reference each function to every other function within the family.
A function can be a member of multiple families.

For `sum()`, this might look like:

```{r}
#' @family aggregations
#' @seealso [prod()] for products, [cumsum()] for cumulative sums, and
#'   [colSums()]/[rowSums()] marginal sums over high-dimensional arrays.
```

By default `@family {family}`, will generate the see also text "Other {family}:", so the `@family` name should be plural (i.e., "model building helpers" not "model building helper").
You can override the default title by providing a `rd_family_title` list in `man/roxygen/meta.R`:

```{r, eval = FALSE}
list(
  rd_family_title = list(aggregations = "Aggregation functions")
)
```

### Suppress documentation

It's sometimes useful to include roxygen2 documentation tags without generating an `.Rd` file.
You can use `@noRd` to suppress file generation for a given topic.

### Indexing

Three other tags make it easier for the user to find documentation within R's help system:

-   Aliases form the index that `?` searches.
    Use `@aliases space separated aliases` to add additional aliases.

-   `@concept` add extra keywords that will be found with `help.search()`

-   Use `@keywords keyword1 keyword2 ...` to add standardised keywords.
    Keywords are optional, but if present, must be taken from the predefined list found `file.path(R.home("doc"), "KEYWORDS")`.

Apart from `@keywords internal`, these tags are not very useful because most people find documentation using Google.
`@keywords internal` is useful because it removes the function from the documentation index; it's useful for functions aimed primarily at other developers, not typical users of the package.

### Back references

The original source location is added as a comment to the second line of each generated `.Rd` file in the following form:

    % Please edit documentation in ...

`roxygen2` tries to capture all locations from which the documentation is assembled.
For code that *generates* R code with Roxygen comments (e.g., the Rcpp package), the `@backref` tag is provided.
This allows specifying the "true" source of the documentation, and will substitute the default list of source files.
Use one tag per source file:

```{r}
#' @backref src/file.cpp
#' @backref src/file.h
```
